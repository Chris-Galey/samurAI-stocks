import{isValidElement as t,useMemo as n,createElement as i}from"react";import{filter as o,omit as e,isNumber as a}from"lodash";import{absoluteAngleDegrees as r,radiansToDegrees as s,positionFromAngle as l,degreesToRadians as u,useTheme as h,useMotionConfig as d,useAnimatedPath as c}from"@nivo/core";import f from"lodash/omit";import{useSpring as y,animated as x}from"@react-spring/web";import{jsxs as m,Fragment as p,jsx as g}from"react/jsx-runtime";function k(){return k=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},k.apply(this,arguments)}var W={dotSize:4,noteWidth:120,noteTextOffset:8,animate:!0},v=function(n){var i=typeof n;return t(n)||"string"===i||"function"===i||"object"===i},b=function(t){var n=typeof t;return"string"===n||"function"===n},w=function(t){return"circle"===t.type},z=function(t){return"dot"===t.type},P=function(t){return"rect"===t.type},C=function(t){var n=t.data,i=t.annotations,a=t.getPosition,r=t.getDimensions;return i.reduce((function(t,i){var s=i.offset||0;return[].concat(t,o(n,i.match).map((function(t){var n=a(t),o=r(t);return(w(i)||P(i))&&(o.size=o.size+2*s,o.width=o.width+2*s,o.height=o.height+2*s),k({},e(i,["match","offset"]),n,o,{size:i.size||o.size,datum:t})})))}),[])},O=function(t,n,i,o){var e=Math.atan2(o-n,i-t);return r(s(e))},S=function(t){var n,i,o=t.x,e=t.y,r=t.noteX,s=t.noteY,h=t.noteWidth,d=void 0===h?W.noteWidth:h,c=t.noteTextOffset,f=void 0===c?W.noteTextOffset:c;if(a(r))n=o+r;else{if(void 0===r.abs)throw new Error("noteX should be either a number or an object containing an 'abs' property");n=r.abs}if(a(s))i=e+s;else{if(void 0===s.abs)throw new Error("noteY should be either a number or an object containing an 'abs' property");i=s.abs}var y=o,x=e,m=O(o,e,n,i);if(w(t)){var p=l(u(m),t.size/2);y+=p.x,x+=p.y}if(P(t)){var g=Math.round((m+90)/45)%8;0===g&&(x-=t.height/2),1===g&&(y+=t.width/2,x-=t.height/2),2===g&&(y+=t.width/2),3===g&&(y+=t.width/2,x+=t.height/2),4===g&&(x+=t.height/2),5===g&&(y-=t.width/2,x+=t.height/2),6===g&&(y-=t.width/2),7===g&&(y-=t.width/2,x-=t.height/2)}var k=n,v=n;return(m+90)%360>180?(k-=d,v-=d):v+=d,{points:[[y,x],[n,i],[v,i]],text:[k,i-f],angle:m+90}},j=function(t){var i=t.data,o=t.annotations,e=t.getPosition,a=t.getDimensions;return n((function(){return C({data:i,annotations:o,getPosition:e,getDimensions:a})}),[i,o,e,a])},M=function(t){var i=t.annotations;return n((function(){return i.map((function(t){return k({},t,{computed:S(k({},t))})}))}),[i])},T=function(t){return n((function(){return S(t)}),[t])},E=function(t){var n=t.datum,o=t.x,e=t.y,a=t.note,r=h(),s=d(),l=s.animate,u=s.config,c=y({x:o,y:e,config:u,immediate:!l});return"function"==typeof a?i(a,{x:o,y:e,datum:n}):m(p,{children:[r.annotations.text.outlineWidth>0&&g(x.text,{x:c.x,y:c.y,style:k({},r.annotations.text,{strokeLinejoin:"round",strokeWidth:2*r.annotations.text.outlineWidth,stroke:r.annotations.text.outlineColor}),children:a}),g(x.text,{x:c.x,y:c.y,style:f(r.annotations.text,["outlineWidth","outlineColor"]),children:a})]})},I=function(t){var i=t.points,o=t.isOutline,e=void 0!==o&&o,a=h(),r=n((function(){var t=i[0];return i.slice(1).reduce((function(t,n){return t+" L"+n[0]+","+n[1]}),"M"+t[0]+","+t[1])}),[i]),s=c(r);if(e&&a.annotations.link.outlineWidth<=0)return null;var l=k({},a.annotations.link);return e&&(l.strokeLinecap="square",l.strokeWidth=a.annotations.link.strokeWidth+2*a.annotations.link.outlineWidth,l.stroke=a.annotations.link.outlineColor,l.opacity=a.annotations.link.outlineOpacity),g(x.path,{fill:"none",d:s,style:l})},D=function(t){var n=t.x,i=t.y,o=t.size,e=h(),a=d(),r=a.animate,s=a.config,l=y({x:n,y:i,radius:o/2,config:s,immediate:!r});return m(p,{children:[e.annotations.outline.outlineWidth>0&&g(x.circle,{cx:l.x,cy:l.y,r:l.radius,style:k({},e.annotations.outline,{fill:"none",strokeWidth:e.annotations.outline.strokeWidth+2*e.annotations.outline.outlineWidth,stroke:e.annotations.outline.outlineColor,opacity:e.annotations.outline.outlineOpacity})}),g(x.circle,{cx:l.x,cy:l.y,r:l.radius,style:e.annotations.outline})]})},L=function(t){var n=t.x,i=t.y,o=t.size,e=void 0===o?W.dotSize:o,a=h(),r=d(),s=r.animate,l=r.config,u=y({x:n,y:i,radius:e/2,config:l,immediate:!s});return m(p,{children:[a.annotations.outline.outlineWidth>0&&g(x.circle,{cx:u.x,cy:u.y,r:u.radius,style:k({},a.annotations.outline,{fill:"none",strokeWidth:2*a.annotations.outline.outlineWidth,stroke:a.annotations.outline.outlineColor,opacity:a.annotations.outline.outlineOpacity})}),g(x.circle,{cx:u.x,cy:u.y,r:u.radius,style:a.annotations.symbol})]})},R=function(t){var n=t.x,i=t.y,o=t.width,e=t.height,a=t.borderRadius,r=void 0===a?6:a,s=h(),l=d(),u=l.animate,c=l.config,f=y({x:n-o/2,y:i-e/2,width:o,height:e,config:c,immediate:!u});return m(p,{children:[s.annotations.outline.outlineWidth>0&&g(x.rect,{x:f.x,y:f.y,rx:r,ry:r,width:f.width,height:f.height,style:k({},s.annotations.outline,{fill:"none",strokeWidth:s.annotations.outline.strokeWidth+2*s.annotations.outline.outlineWidth,stroke:s.annotations.outline.outlineColor,opacity:s.annotations.outline.outlineOpacity})}),g(x.rect,{x:f.x,y:f.y,rx:r,ry:r,width:f.width,height:f.height,style:s.annotations.outline})]})},q=function(t){var n=t.datum,i=t.x,o=t.y,e=t.note,a=T(t);if(!v(e))throw new Error("note should be a valid react element");return m(p,{children:[g(I,{points:a.points,isOutline:!0}),w(t)&&g(D,{x:i,y:o,size:t.size}),z(t)&&g(L,{x:i,y:o,size:t.size}),P(t)&&g(R,{x:i,y:o,width:t.width,height:t.height,borderRadius:t.borderRadius}),g(I,{points:a.points}),g(E,{datum:n,x:a.text[0],y:a.text[1],note:e})]})},J=function(t,n){n.forEach((function(n,i){var o=n[0],e=n[1];0===i?t.moveTo(o,e):t.lineTo(o,e)}))},X=function(t,n){var i=n.annotations,o=n.theme;0!==i.length&&(t.save(),i.forEach((function(n){if(!b(n.note))throw new Error("note is invalid for canvas implementation");o.annotations.link.outlineWidth>0&&(t.lineCap="square",t.strokeStyle=o.annotations.link.outlineColor,t.lineWidth=o.annotations.link.strokeWidth+2*o.annotations.link.outlineWidth,t.beginPath(),J(t,n.computed.points),t.stroke(),t.lineCap="butt"),w(n)&&o.annotations.outline.outlineWidth>0&&(t.strokeStyle=o.annotations.outline.outlineColor,t.lineWidth=o.annotations.outline.strokeWidth+2*o.annotations.outline.outlineWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),z(n)&&o.annotations.symbol.outlineWidth>0&&(t.strokeStyle=o.annotations.symbol.outlineColor,t.lineWidth=2*o.annotations.symbol.outlineWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),P(n)&&o.annotations.outline.outlineWidth>0&&(t.strokeStyle=o.annotations.outline.outlineColor,t.lineWidth=o.annotations.outline.strokeWidth+2*o.annotations.outline.outlineWidth,t.beginPath(),t.rect(n.x-n.width/2,n.y-n.height/2,n.width,n.height),t.stroke()),t.strokeStyle=o.annotations.link.stroke,t.lineWidth=o.annotations.link.strokeWidth,t.beginPath(),J(t,n.computed.points),t.stroke(),w(n)&&(t.strokeStyle=o.annotations.outline.stroke,t.lineWidth=o.annotations.outline.strokeWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),z(n)&&(t.fillStyle=o.annotations.symbol.fill,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.fill()),P(n)&&(t.strokeStyle=o.annotations.outline.stroke,t.lineWidth=o.annotations.outline.strokeWidth,t.beginPath(),t.rect(n.x-n.width/2,n.y-n.height/2,n.width,n.height),t.stroke()),"function"==typeof n.note?n.note(t,{datum:n.datum,x:n.computed.text[0],y:n.computed.text[1],theme:o}):(t.font=o.annotations.text.fontSize+"px "+o.annotations.text.fontFamily,t.textAlign="left",t.textBaseline="alphabetic",t.fillStyle=o.annotations.text.fill,t.strokeStyle=o.annotations.text.outlineColor,t.lineWidth=2*o.annotations.text.outlineWidth,o.annotations.text.outlineWidth>0&&(t.lineJoin="round",t.strokeText(n.note,n.computed.text[0],n.computed.text[1]),t.lineJoin="miter"),t.fillText(n.note,n.computed.text[0],n.computed.text[1]))})),t.restore())};export{q as Annotation,C as bindAnnotations,S as computeAnnotation,W as defaultProps,O as getLinkAngle,b as isCanvasNote,w as isCircleAnnotation,z as isDotAnnotation,P as isRectAnnotation,v as isSvgNote,X as renderAnnotationsToCanvas,j as useAnnotations,T as useComputedAnnotation,M as useComputedAnnotations};
//# sourceMappingURL=nivo-annotations.es.js.map
