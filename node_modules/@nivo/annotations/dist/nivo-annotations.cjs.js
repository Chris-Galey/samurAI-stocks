"use strict";var t=require("react"),n=require("lodash"),e=require("@nivo/core"),i=require("lodash/omit"),o=require("@react-spring/web"),a=require("react/jsx-runtime");function s(){return s=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},s.apply(this,arguments)}var r={dotSize:4,noteWidth:120,noteTextOffset:8,animate:!0},u=function(n){var e=typeof n;return t.isValidElement(n)||"string"===e||"function"===e||"object"===e},l=function(t){var n=typeof t;return"string"===n||"function"===n},h=function(t){return"circle"===t.type},d=function(t){return"dot"===t.type},c=function(t){return"rect"===t.type},x=function(t){var e=t.data,i=t.annotations,o=t.getPosition,a=t.getDimensions;return i.reduce((function(t,i){var r=i.offset||0;return[].concat(t,n.filter(e,i.match).map((function(t){var e=o(t),u=a(t);return(h(i)||c(i))&&(u.size=u.size+2*r,u.width=u.width+2*r,u.height=u.height+2*r),s({},n.omit(i,["match","offset"]),e,u,{size:i.size||u.size,datum:t})})))}),[])},f=function(t,n,i,o){var a=Math.atan2(o-n,i-t);return e.absoluteAngleDegrees(e.radiansToDegrees(a))},m=function(t){var i,o,a=t.x,s=t.y,u=t.noteX,l=t.noteY,d=t.noteWidth,x=void 0===d?r.noteWidth:d,m=t.noteTextOffset,y=void 0===m?r.noteTextOffset:m;if(n.isNumber(u))i=a+u;else{if(void 0===u.abs)throw new Error("noteX should be either a number or an object containing an 'abs' property");i=u.abs}if(n.isNumber(l))o=s+l;else{if(void 0===l.abs)throw new Error("noteY should be either a number or an object containing an 'abs' property");o=l.abs}var g=a,p=s,k=f(a,s,i,o);if(h(t)){var W=e.positionFromAngle(e.degreesToRadians(k),t.size/2);g+=W.x,p+=W.y}if(c(t)){var v=Math.round((k+90)/45)%8;0===v&&(p-=t.height/2),1===v&&(g+=t.width/2,p-=t.height/2),2===v&&(g+=t.width/2),3===v&&(g+=t.width/2,p+=t.height/2),4===v&&(p+=t.height/2),5===v&&(g-=t.width/2,p+=t.height/2),6===v&&(g-=t.width/2),7===v&&(g-=t.width/2,p-=t.height/2)}var b=i,w=i;return(k+90)%360>180?(b-=x,w-=x):w+=x,{points:[[g,p],[i,o],[w,o]],text:[b,o-y],angle:k+90}},y=function(n){return t.useMemo((function(){return m(n)}),[n])},g=function(n){var r=n.datum,u=n.x,l=n.y,h=n.note,d=e.useTheme(),c=e.useMotionConfig(),x=c.animate,f=c.config,m=o.useSpring({x:u,y:l,config:f,immediate:!x});return"function"==typeof h?t.createElement(h,{x:u,y:l,datum:r}):a.jsxs(a.Fragment,{children:[d.annotations.text.outlineWidth>0&&a.jsx(o.animated.text,{x:m.x,y:m.y,style:s({},d.annotations.text,{strokeLinejoin:"round",strokeWidth:2*d.annotations.text.outlineWidth,stroke:d.annotations.text.outlineColor}),children:h}),a.jsx(o.animated.text,{x:m.x,y:m.y,style:i(d.annotations.text,["outlineWidth","outlineColor"]),children:h})]})},p=function(n){var i=n.points,r=n.isOutline,u=void 0!==r&&r,l=e.useTheme(),h=t.useMemo((function(){var t=i[0];return i.slice(1).reduce((function(t,n){return t+" L"+n[0]+","+n[1]}),"M"+t[0]+","+t[1])}),[i]),d=e.useAnimatedPath(h);if(u&&l.annotations.link.outlineWidth<=0)return null;var c=s({},l.annotations.link);return u&&(c.strokeLinecap="square",c.strokeWidth=l.annotations.link.strokeWidth+2*l.annotations.link.outlineWidth,c.stroke=l.annotations.link.outlineColor,c.opacity=l.annotations.link.outlineOpacity),a.jsx(o.animated.path,{fill:"none",d:d,style:c})},k=function(t){var n=t.x,i=t.y,r=t.size,u=e.useTheme(),l=e.useMotionConfig(),h=l.animate,d=l.config,c=o.useSpring({x:n,y:i,radius:r/2,config:d,immediate:!h});return a.jsxs(a.Fragment,{children:[u.annotations.outline.outlineWidth>0&&a.jsx(o.animated.circle,{cx:c.x,cy:c.y,r:c.radius,style:s({},u.annotations.outline,{fill:"none",strokeWidth:u.annotations.outline.strokeWidth+2*u.annotations.outline.outlineWidth,stroke:u.annotations.outline.outlineColor,opacity:u.annotations.outline.outlineOpacity})}),a.jsx(o.animated.circle,{cx:c.x,cy:c.y,r:c.radius,style:u.annotations.outline})]})},W=function(t){var n=t.x,i=t.y,u=t.size,l=void 0===u?r.dotSize:u,h=e.useTheme(),d=e.useMotionConfig(),c=d.animate,x=d.config,f=o.useSpring({x:n,y:i,radius:l/2,config:x,immediate:!c});return a.jsxs(a.Fragment,{children:[h.annotations.outline.outlineWidth>0&&a.jsx(o.animated.circle,{cx:f.x,cy:f.y,r:f.radius,style:s({},h.annotations.outline,{fill:"none",strokeWidth:2*h.annotations.outline.outlineWidth,stroke:h.annotations.outline.outlineColor,opacity:h.annotations.outline.outlineOpacity})}),a.jsx(o.animated.circle,{cx:f.x,cy:f.y,r:f.radius,style:h.annotations.symbol})]})},v=function(t){var n=t.x,i=t.y,r=t.width,u=t.height,l=t.borderRadius,h=void 0===l?6:l,d=e.useTheme(),c=e.useMotionConfig(),x=c.animate,f=c.config,m=o.useSpring({x:n-r/2,y:i-u/2,width:r,height:u,config:f,immediate:!x});return a.jsxs(a.Fragment,{children:[d.annotations.outline.outlineWidth>0&&a.jsx(o.animated.rect,{x:m.x,y:m.y,rx:h,ry:h,width:m.width,height:m.height,style:s({},d.annotations.outline,{fill:"none",strokeWidth:d.annotations.outline.strokeWidth+2*d.annotations.outline.outlineWidth,stroke:d.annotations.outline.outlineColor,opacity:d.annotations.outline.outlineOpacity})}),a.jsx(o.animated.rect,{x:m.x,y:m.y,rx:h,ry:h,width:m.width,height:m.height,style:d.annotations.outline})]})},b=function(t,n){n.forEach((function(n,e){var i=n[0],o=n[1];0===e?t.moveTo(i,o):t.lineTo(i,o)}))};exports.Annotation=function(t){var n=t.datum,e=t.x,i=t.y,o=t.note,s=y(t);if(!u(o))throw new Error("note should be a valid react element");return a.jsxs(a.Fragment,{children:[a.jsx(p,{points:s.points,isOutline:!0}),h(t)&&a.jsx(k,{x:e,y:i,size:t.size}),d(t)&&a.jsx(W,{x:e,y:i,size:t.size}),c(t)&&a.jsx(v,{x:e,y:i,width:t.width,height:t.height,borderRadius:t.borderRadius}),a.jsx(p,{points:s.points}),a.jsx(g,{datum:n,x:s.text[0],y:s.text[1],note:o})]})},exports.bindAnnotations=x,exports.computeAnnotation=m,exports.defaultProps=r,exports.getLinkAngle=f,exports.isCanvasNote=l,exports.isCircleAnnotation=h,exports.isDotAnnotation=d,exports.isRectAnnotation=c,exports.isSvgNote=u,exports.renderAnnotationsToCanvas=function(t,n){var e=n.annotations,i=n.theme;0!==e.length&&(t.save(),e.forEach((function(n){if(!l(n.note))throw new Error("note is invalid for canvas implementation");i.annotations.link.outlineWidth>0&&(t.lineCap="square",t.strokeStyle=i.annotations.link.outlineColor,t.lineWidth=i.annotations.link.strokeWidth+2*i.annotations.link.outlineWidth,t.beginPath(),b(t,n.computed.points),t.stroke(),t.lineCap="butt"),h(n)&&i.annotations.outline.outlineWidth>0&&(t.strokeStyle=i.annotations.outline.outlineColor,t.lineWidth=i.annotations.outline.strokeWidth+2*i.annotations.outline.outlineWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),d(n)&&i.annotations.symbol.outlineWidth>0&&(t.strokeStyle=i.annotations.symbol.outlineColor,t.lineWidth=2*i.annotations.symbol.outlineWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),c(n)&&i.annotations.outline.outlineWidth>0&&(t.strokeStyle=i.annotations.outline.outlineColor,t.lineWidth=i.annotations.outline.strokeWidth+2*i.annotations.outline.outlineWidth,t.beginPath(),t.rect(n.x-n.width/2,n.y-n.height/2,n.width,n.height),t.stroke()),t.strokeStyle=i.annotations.link.stroke,t.lineWidth=i.annotations.link.strokeWidth,t.beginPath(),b(t,n.computed.points),t.stroke(),h(n)&&(t.strokeStyle=i.annotations.outline.stroke,t.lineWidth=i.annotations.outline.strokeWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),d(n)&&(t.fillStyle=i.annotations.symbol.fill,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.fill()),c(n)&&(t.strokeStyle=i.annotations.outline.stroke,t.lineWidth=i.annotations.outline.strokeWidth,t.beginPath(),t.rect(n.x-n.width/2,n.y-n.height/2,n.width,n.height),t.stroke()),"function"==typeof n.note?n.note(t,{datum:n.datum,x:n.computed.text[0],y:n.computed.text[1],theme:i}):(t.font=i.annotations.text.fontSize+"px "+i.annotations.text.fontFamily,t.textAlign="left",t.textBaseline="alphabetic",t.fillStyle=i.annotations.text.fill,t.strokeStyle=i.annotations.text.outlineColor,t.lineWidth=2*i.annotations.text.outlineWidth,i.annotations.text.outlineWidth>0&&(t.lineJoin="round",t.strokeText(n.note,n.computed.text[0],n.computed.text[1]),t.lineJoin="miter"),t.fillText(n.note,n.computed.text[0],n.computed.text[1]))})),t.restore())},exports.useAnnotations=function(n){var e=n.data,i=n.annotations,o=n.getPosition,a=n.getDimensions;return t.useMemo((function(){return x({data:e,annotations:i,getPosition:o,getDimensions:a})}),[e,i,o,a])},exports.useComputedAnnotation=y,exports.useComputedAnnotations=function(n){var e=n.annotations;return t.useMemo((function(){return e.map((function(t){return s({},t,{computed:m(s({},t))})}))}),[e])};
//# sourceMappingURL=nivo-annotations.cjs.js.map
